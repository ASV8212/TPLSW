!function(a){a.extend(a.tis._tisGrid.prototype,{selectallrows:function(){this._trigger=!1;var a=this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=new Array;for(var b=this.dataview.loadedrecords,c=0;c<a;c++){var d=b[c];if(d){var e=this.getboundindex(d);void 0!=e&&(this.selectedrowindexes[c]=e)}else this.selectedrowindexes[c]=c}"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.tisCheckBox({checked:!0}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},unselectallrows:function(){this._trigger=!1;this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=new Array,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.tisCheckBox({checked:!1}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},selectrow:function(a,b){this._applyrowselection(a,!0,b),!1!==b&&this._updatecheckboxselection()},_updatecheckboxselection:function(){if("checkbox"==this.selectionmode){var a=this.getrows();if(a&&this._checkboxcolumn){if(0===a.length)return void this._checkboxcolumn.checkboxelement.tisCheckBox({checked:!1});var b=a.length;this.groupable&&(b=this.dataview.loadedrecords.length),this.virtualmode&&(b=this.source._source.totalrecords);var c=this.selectedrowindexes.length;c===b?this._checkboxcolumn.checkboxelement.tisCheckBox({checked:!0}):0===c?this._checkboxcolumn.checkboxelement.tisCheckBox({checked:!1}):this._checkboxcolumn.checkboxelement.tisCheckBox({checked:null})}}},unselectrow:function(a,b){this._applyrowselection(a,!1,b),!1!==b&&this._updatecheckboxselection()},selectcell:function(a,b){this._applycellselection(a,b,!0)},unselectcell:function(a,b){this._applycellselection(a,b,!1)},clearselection:function(a,b){if(this._trigger=!1,this.selectedrowindex=-1,this._oldselectedcell=null,!1!==b)for(var c=0;c<this.selectedrowindexes.length;c++)this._raiseEvent(3,{rowindex:this.selectedrowindexes[c]});if(this.selectedrowindexes=new Array,this.selectedcells=new Array,this.selectedcell=null,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn.checkboxelement.tisCheckBox({checked:!1}),!1===a)return void(this._trigger=!0);this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(3,{rowindex:this.selectedrowindexes})},getselectedrowindex:function(){if(-1==this.selectedrowindex||void 0==this.selectedrowindex)for(var a=0;a<this.selectedrowindexes.length;a++)return this.selectedrowindexes[a];return this.selectedrowindex},getselectedrowindexes:function(){return this.selectedrowindexes},getselectedcell:function(){if(!this.selectedcell)return null;var a=this.selectedcell;return a.row=this.selectedcell.rowindex,a.column=this.selectedcell.datafield,a.value=this.getcellvalue(a.row,a.column),a},getselectedcells:function(){var a=new Array;for(obj in this.selectedcells)a[a.length]=this.selectedcells[obj];return a},_getcellsforcopypaste:function(){var a=new Array;if(-1==this.selectionmode.indexOf("cell"))for(var b=this.selectedrowindexes,c=0;c<b.length;c++)for(var d=b[c],e=0;e<this.columns.records.length;e++)if("_checkboxcolumn"!==this.columns.records[e].datafield){var g=(this.columns.records[e].datafield,{rowindex:d,datafield:this.columns.records[e].datafield});a.push(g)}return a},deleteselection:function(){var a=this,b=a.getselectedcells();if(-1==this.selectionmode.indexOf("cell")&&(b=this._getcellsforcopypaste()),null!=b&&b.length>0){for(var c=0;c<b.length;c++){var d=b[c],e=a.getcolumn(d.datafield),f=a.getcellvalue(d.rowindex,d.datafield);if(e&&""!==f){var g=null;"checkbox"==e.columntype&&(e.threestatecheckbox||(g=!1)),a._raiseEvent(17,{rowindex:d.rowindex,datafield:d.datafield,value:f}),c==b.length-1?(a.setcellvalue(d.rowindex,d.datafield,g,!0),e.displayfield!=e.datafield&&a.setcellvalue(d.rowindex,e.displayfield,g,!0)):(a.setcellvalue(d.rowindex,d.datafield,g,!1),e.displayfield!=e.datafield&&a.setcellvalue(d.rowindex,e.displayfield,g,!0)),a._raiseEvent(18,{rowindex:d.rowindex,datafield:d.datafield,oldvalue:f,value:g})}}this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}},copyselection:function(){var b="",c=this;this.clipboardselection={},this.logicalclipboardselection={},this._clipboardselection=[];var d=c.getselectedcells();-1==this.selectionmode.indexOf("cell")&&(d=this._getcellsforcopypaste());var f=new Array;if(null!=d&&d.length>0){for(var g=999999999999999,h=-1,i=0;i<d.length;i++){var j=d[i],k=c.getcolumn(j.datafield);if(null!=k&&k.clipboard&&(!k.hidden||this.copytoclipboardhiddencolumns)){-1==f.indexOf(k.text)&&f.push(k.text);var l=c.getcelltext(j.rowindex,k.displayfield),m=this.getrowdisplayindex(j.rowindex);this.clipboardselection[m]||(this.clipboardselection[m]={}),this.clipboardselection[m][k.displayfield]=l,this.logicalclipboardselection[m]||(this.logicalclipboardselection[m]={}),this.logicalclipboardselection[m][k.displayfield]=l,k.displayfield!=k.datafield&&(this.logicalclipboardselection[m][k.datafield]=c.getcellvalue(j.rowindex,k.datafield)),g=Math.min(g,m),h=Math.max(h,m)}}for(var n=new Array,o=g;o<=h;o++)if(this.logicalclipboardselection[o]){var p=a.extend({},this.logicalclipboardselection[o]);n.push(p)}if(this.logicalclipboardselection=n,this.copytoclipboardwithheaders){for(var q=0;q<f.length;q++)q>0&&(b+="\t"),b+=f[q];b+="\r\n"}for(var o=g;o<=h;o++){var r=0;this._clipboardselection[this._clipboardselection.length]=new Array,void 0!=this.clipboardselection[o]&&(a.each(this.clipboardselection[o],function(a,d){r>0&&(b+="\t");var e=d;null==d&&(e=""),c._clipboardselection[c._clipboardselection.length-1][r]=e,r++,b+=e}),o<h&&(b+="\r\n"))}}return this.clipboardselectedtext=b,b},pasteselection:function(){var a=this.getselectedcells();if(this._oldselectedcell=null,-1==this.selectionmode.indexOf("cell")&&(a=this._getcellsforcopypaste()),null!=a&&a.length>0){var b=a[0].rowindex,c=this.getrowdisplayindex(b),d=a[0].datafield,e=this._getcolumnindex(d);this.selectedrowindexes=new Array,this.selectedcells=new Array;var h=(a.length,0),i=new Array;this.copytoclipboardwithheaders&&this._clipboardselection.splice(0,1);for(var j=0;j<this._clipboardselection.length;j++){h+=this._clipboardselection[j].length,i[j]=new Array;for(var k=0;k<this._clipboardselection[j].length;k++){var l=this._clipboardselection[j][k];i[j].push(l)}}if(h<a.length){for(var m=new Array,j=0;j<a.length;j++){var n=a[j];m[n.rowindex]||(m[n.rowindex]=new Array),m[n.rowindex].push(n)}for(var o=0,p=0,j=0;j<m.length;j++)if(m[j]){for(var k=0;k<m[j].length;k++){var n=m[j][k],q=n.rowindex,r=this.getcolumn(n.datafield);if("_checkboxcolumn"!==r.datafield&&!r.hidden){var l="";if(i[o][p]||(p=0),l=i[o][p],p++,r.cellsformat&&(-1!=r.cellsformat.indexOf("p")||-1!=r.cellsformat.indexOf("c")||-1!=r.cellsformat.indexOf("n")||-1!=r.cellsformat.indexOf("f"))){l.indexOf(this.gridlocalization.currencysymbol)>-1&&(l=l.replace(this.gridlocalization.currencysymbol,""));var s=function(a,b,c){var d=a;if(b==c)return a;for(var e=d.indexOf(b);-1!=e;)d=d.replace(b,c),e=d.indexOf(b);return d};l=s(l,this.gridlocalization.thousandsseparator,""),l=l.replace(this.gridlocalization.decimalseparator,"."),l.indexOf(this.gridlocalization.percentsymbol)>-1&&(l=l.replace(this.gridlocalization.percentsymbol,""));for(var t="",u=0;u<l.length;u++){var v=l.substring(u,u+1);"-"===v&&(t+="-"),"."===v&&(t+="."),null!=v.match(/^[0-9]+$/)&&(t+=v)}l=t,l=l.replace(/ /g,""),l=new Number(l),isNaN(l)&&(l="")}if(this._raiseEvent(17,{rowindex:q,datafield:n.datafield,value:l}),this.setcellvalue(q,r.displayfield,l,!1),r.displayfield!=r.datafield&&this.logicalclipboardselection&&this.logicalclipboardselection[q]){var w=this.logicalclipboardselection[q][r.datafield];void 0!=w&&this.setcellvalue(q,r.datafield,w,!1)}this._raiseEvent(18,{rowindex:q,datafield:n.datafield,oldvalue:this.getcellvalue(n.rowindex,n.datafield),value:l}),this._applycellselection(q,n.datafield,!0,!1)}}o++,i[o]||(o=0)}}else{if(!this._clipboardselection)return;for(var x=0;x<this._clipboardselection.length;x++)for(var y=0;y<this._clipboardselection[x].length;y++){var r=this.getcolumnat(e+y);if(r&&("_checkboxcolumn"!==r.datafield&&!r.hidden)){var q=this.getrowboundindex(c+x),n=this.getcell(q,r.datafield),l=null;if(null!=(l=this._clipboardselection[x][y])){if(r.cellsformat&&(-1!=r.cellsformat.indexOf("p")||-1!=r.cellsformat.indexOf("c")||-1!=r.cellsformat.indexOf("n")||-1!=r.cellsformat.indexOf("f"))){l.indexOf(this.gridlocalization.currencysymbol)>-1&&(l=l.replace(this.gridlocalization.currencysymbol,""));var s=function(a,b,c){var d=a;if(b==c)return a;for(var e=d.indexOf(b);-1!=e;)d=d.replace(b,c),e=d.indexOf(b);return d};l=s(l,this.gridlocalization.thousandsseparator,""),l=l.replace(this.gridlocalization.decimalseparator,"."),l.indexOf(this.gridlocalization.percentsymbol)>-1&&(l=l.replace(this.gridlocalization.percentsymbol,""));for(var t="",u=0;u<l.length;u++){var v=l.substring(u,u+1);"-"===v&&(t+="-"),"."===v&&(t+="."),null!=v.match(/^[0-9]+$/)&&(t+=v)}l=t,l=l.replace(/ /g,""),l=new Number(l),isNaN(l)&&(l="")}if(this._raiseEvent(17,{rowindex:q,datafield:n.datafield,value:l}),this.setcellvalue(q,r.displayfield,l,!1),r.displayfield!=r.datafield&&this.logicalclipboardselection){var w=this.logicalclipboardselection[x][r.datafield];void 0!=w&&this.setcellvalue(q,r.datafield,w,!1)}this._raiseEvent(18,{rowindex:q,datafield:n.datafield,oldvalue:this.getcellvalue(n.rowindex,n.datafield),value:l}),this._applycellselection(q,n.datafield,!0,!1)}}}}"checkbox"==this.selectionmode&&this._updatecheckboxselection(),this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}this.clipboardend&&this.clipboardend("paste")},_applyrowselection:function(a,b,c,d,e){if(null==a)return!1;var f=this.selectedrowindex;if("singlerow"==this.selectionmode&&(b?this._raiseEvent(2,{rowindex:a,row:this.getrowdata(a)}):this._raiseEvent(3,{rowindex:a,row:this.getrowdata(a)}),this._raiseEvent(3,{rowindex:f}),this.selectedrowindexes=new Array,this.selectedcells=new Array),1==d&&(this.selectedrowindexes=new Array),this.dataview.filters.length>0){var g=this.getrowdata(a);g&&void 0!==g.dataindex?a=g.dataindex:g&&void 0===g.dataindex&&void 0!=g.uid&&(a=this.getrowboundindexbyid(g.uid))}var h=this.selectedrowindexes.indexOf(a);if(b)this.selectedrowindex=a,-1==h?(this.selectedrowindexes.push(a),"singlerow"!=this.selectionmode&&this._raiseEvent(2,{rowindex:a,row:this.getrowdata(a)})):"multiplerows"==this.selectionmode&&(this.selectedrowindexes.splice(h,1),this._raiseEvent(3,{rowindex:this.selectedrowindex,row:this.getrowdata(a)}),this.selectedrowindex=this.selectedrowindexes.length>0?this.selectedrowindexes[this.selectedrowindexes.length-1]:-1);else if(h>=0||"singlerow"==this.selectionmode||"multiplerowsextended"==this.selectionmode||"multiplerowsadvanced"==this.selectionmode){var i=this.selectedrowindexes[h];this.selectedrowindexes.splice(h,1),this._raiseEvent(3,{rowindex:i,row:this.getrowdata(a)}),this.selectedrowindex=-1}return(void 0==c||c)&&this._rendervisualrows(),!0},_applycellselection:function(a,b,c,d){if(null==a)return!1;if(null==b)return!1;this.selectedrowindex;if("singlecell"==this.selectionmode){var f=this.selectedcell;null!=f&&this._raiseEvent(16,{rowindex:f.rowindex,datafield:f.datafield}),this.selectedcells=new Array}if("multiplecellsextended"==this.selectionmode||"multiplecellsadvanced"==this.selectionmode){var f=this.selectedcell;null!=f&&this._raiseEvent(16,{rowindex:f.rowindex,datafield:f.datafield})}var g=a+"_"+b;if(this.dataview.filters.length>0){var h=this.getrowdata(a);if(h&&void 0!==h.dataindex){a=h.dataindex;var g=a+"_"+b}else if(h&&void 0===h.dataindex&&h.uid){a=this.getrowboundindexbyid(h.uid);var g=a+"_"+b}}var i={rowindex:a,datafield:b};return c?(this.selectedcell=i,this.selectedcells[g]?"multiplecells"!=this.selectionmode&&"multiplecellsextended"!=this.selectionmode&&"multiplecellsadvanced"!=this.selectionmode||(delete this.selectedcells[g],this.selectedcells.length>0&&this.selectedcells.length--,this._raiseEvent(16,i)):(this.selectedcells[g]=i,this.selectedcells.length++,this._raiseEvent(15,i))):(delete this.selectedcells[g],this.selectedcells.length>0&&this.selectedcells.length--,this._raiseEvent(16,i)),(void 0==d||d)&&this._rendervisualrows(),!0},_getcellindex:function(b){var c=-1;return a.each(this.selectedcells,function(){if(c++,this[b])return!1}),c},_clearhoverstyle:function(){if(void 0!=this.hoveredrow&&-1!=this.hoveredrow&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var a=this.table.find(".tis-grid-cell-hover");a.length>0&&(a.removeClass(this.toTP("tis-grid-cell-hover")),a.removeClass(this.toTP("tis-fill-state-hover"))),this.hoveredrow=-1}},_clearselectstyle:function(){for(var b=this.table[0].rows.length,c=this.table[0].rows,d=this.toTP("tis-grid-cell-selected"),e=this.toTP("tis-fill-state-pressed"),f=this.toTP("tis-grid-cell-hover"),g=this.toTP("tis-fill-state-hover"),h=0;h<b;h++)for(var i=c[h],j=i.cells.length,k=i.cells,l=0;l<j;l++){var m=k[l],n=a(m);-1!=m.className.indexOf("tis-grid-cell-selected")&&(n.removeClass(d),n.removeClass(e)),-1!=m.className.indexOf("tis-grid-cell-hover")&&(n.removeClass(f),n.removeClass(g))}},_selectpath:function(a,b){var c=this,d=this._lastClickedCell?Math.min(this._lastClickedCell.row,a):0,e=this._lastClickedCell?Math.max(this._lastClickedCell.row,a):0;if(d<=e){var f=this._getcolumnindex(this._lastClickedCell.column),g=this._getcolumnindex(b),h=Math.min(f,g),i=Math.max(f,g);this.selectedcells=new Array;for(var j=this.dataview.loadedrecords,k=d;k<=e;k++)for(var l=h;l<=i;l++){var a=j[k];this._applycellselection(c.getboundindex(a),c._getcolumnat(l).datafield,!0,!1)}this._rendervisualrows()}},_selectrowpath:function(a){if("multiplerowsextended"==this.selectionmode){var c=this._lastClickedCell?Math.min(this._lastClickedCell.row,a):0,d=this._lastClickedCell?Math.max(this._lastClickedCell.row,a):0,e=this.dataview.loadedrecords;if(c<=d){this.selectedrowindexes=new Array;for(var f=c;f<=d;f++){var a=e[f],g=this.getrowboundindex(f);this._applyrowselection(g,!0,!1)}this._rendervisualrows()}}},_selectrowwithmouse:function(a,b,c,d,e,f){var g=b.row;if(void 0!=g){var h=b.index;if(void 0!=this.hittestinfo[h]){var i=this.hittestinfo[h].visualrow;if(!this.hittestinfo[h].details){i.cells[0].className;if(!g.group){if("multiplerows"==this.selectionmode||"multiplecells"==this.selectionmode||"checkbox"==this.selectionmode||-1!=this.selectionmode.indexOf("multiple")&&(1==f||1==e)){var k=this.getboundindex(g);if(this.dataview.filters.length>0){var l=this.getrowdata(k);if(l&&void 0==(k=l.dataindex))var k=this.getboundindex(g)}var m=-1!=c.indexOf(k),n=this.getboundindex(g)+"_"+d;if(-1!=this.selectionmode.indexOf("cell")){var o=void 0!=this.selectedcells[n];if(void 0!=this.selectedcells[n]&&o?this._selectcellwithstyle(a,!1,h,d,i):this._selectcellwithstyle(a,!0,h,d,i),f&&void 0==this._lastClickedCell){var p=this.getselectedcells();p&&p.length>0&&(this._lastClickedCell={row:p[0].rowindex,column:p[0].datafield})}f&&this._lastClickedCell&&(this._selectpath(g.visibleindex,d),this.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")&&this.selectionarea.css("visibility","hidden"))}else{if(m?e?this._applyrowselection(this.getboundindex(g),!1):this._selectrowwithstyle(a,i,!1,d):this._selectrowwithstyle(a,i,!0,d),f&&void 0==this._lastClickedCell){var q=this.getselectedrowindexes();q&&q.length>0&&(this._lastClickedCell={row:q[0],column:d})}if(f&&this._lastClickedCell){this.selectedrowindexes=new Array;for(var r=this._lastClickedCell?Math.min(this._lastClickedCell.row,g.visibleindex):0,s=this._lastClickedCell?Math.max(this._lastClickedCell.row,g.visibleindex):0,t=this.dataview.loadedrecords,u=r;u<=s;u++){var g=t[u];g&&this._applyrowselection(this.getboundindex(g),!0,!1,!1)}this._rendervisualrows()}}}else this._clearselectstyle(),this._selectrowwithstyle(a,i,!0,d),-1!=this.selectionmode.indexOf("cell")&&this._selectcellwithstyle(a,!0,h,d,i);f||(this._lastClickedCell={row:g.visibleindex,column:d})}}}}},_selectcellwithstyle:function(b,c,d,e,f){var g=a(f.cells[b._getcolumnindex(e)]);g.removeClass(this.toTP("tis-grid-cell-hover")),g.removeClass(this.toTP("tis-fill-state-hover")),c?(g.addClass(this.toTP("tis-grid-cell-selected")),g.addClass(this.toTP("tis-fill-state-pressed"))):(g.removeClass(this.toTP("tis-grid-cell-selected")),g.removeClass(this.toTP("tis-fill-state-pressed")))},_selectrowwithstyle:function(b,c,d,e){var f=c.cells.length,g=0;b.rowdetails&&b.showrowdetailscolumn?this.rtl?(f-=1,f-=this.groups.length):g=1+this.groups.length:this.groupable&&(this.rtl?f-=this.groups.length:g=this.groups.length);for(var h=g;h<f;h++){var i=c.cells[h];d?(a(i).removeClass(this.toTP("tis-grid-cell-hover")),a(i).removeClass(this.toTP("tis-fill-state-hover")),-1==b.selectionmode.indexOf("cell")&&(a(i).addClass(this.toTP("tis-grid-cell-selected")),a(i).addClass(this.toTP("tis-fill-state-pressed")))):(a(i).removeClass(this.toTP("tis-grid-cell-hover")),a(i).removeClass(this.toTP("tis-grid-cell-selected")),a(i).removeClass(this.toTP("tis-fill-state-hover")),a(i).removeClass(this.toTP("tis-fill-state-pressed")))}},_handlemousemoveselection:function(b,c){if(c.hScrollInstance.isScrolling()||c.vScrollInstance.isScrolling())return!1;if(("multiplerowsextended"==c.selectionmode||"multiplecellsextended"==c.selectionmode||"multiplecellsadvanced"==c.selectionmode)&&c.mousecaptured){if(c.multipleselectionbegins){if(!1===c.multipleselectionbegins(b))return!0}var e=this.showheader?this.columnsheader.height()+2:0,f=this._groupsheader()?this.groupsheader.height():0;f+=this.showtoolbar?this.toolbar.height():0;var h=this.host.coord();if(this.hasTransform){h=a.tis.utilities.getOffset(this.host);var i=this._getBodyOffset();h.left-=i.left,h.top-=i.top}"0px"===this.host.css("border-top-width")&&(f-=2);var j=b.pageX,k=b.pageY-f;if(Math.abs(this.mousecaptureposition.left-j)>3||Math.abs(this.mousecaptureposition.top-k)>3){parseInt(this.columnsheader.coord().top);this.hasTransform&&a.tis.utilities.getOffset(this.columnsheader).top,j<h.left&&(j=h.left),j>h.left+this.host.width()&&(j=h.left+this.host.width());var m=h.top+e;k<m&&(k=m+5);var n=parseInt(Math.min(c.mousecaptureposition.left,j)),o=-5+parseInt(Math.min(c.mousecaptureposition.top,k)),p=parseFloat(Math.abs(c.mousecaptureposition.left-j)),q=parseInt(Math.abs(c.mousecaptureposition.top-k));if(n-=h.left,o-=h.top,this.selectionarea.css("visibility","visible"),"multiplecellsadvanced"==c.selectionmode){var j=n,r=j+p,t=c.hScrollInstance,u=t.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(u=t.max-t.value),this.vScrollBar[0].style.visibility);var v=c.table[0].rows[0],w=0,x=c.mousecaptureposition.clickedcell,y=x,z=!1,A=0,B=v.cells.length;c.mousecaptureposition.left<=b.pageX&&(A=x);for(var C=!1,D=A;D<B;D++){var E=parseFloat(a(this.columnsrow[0].cells[D]).css("left")),F=E-u;if(!c.columns.records[D].pinned||c.columns.records[D].hidden){if(C){z=!0,y--;break}var H=this._getcolumnat(D);if(!(null!=H&&H.hidden||c.groupable&&c.groups.length>0&&D<c.groups.length)){var G=F+a(this.columnsrow[0].cells[D]).width();if(c.mousecaptureposition.left>b.pageX){if(G>=j&&j>=F){y=D,z=!0;break}}else if(G>=r&&r>=F){y=D,z=!0;break}}}else{D==x&&(C=!0);var G=E+a(this.columnsrow[0].cells[D]).width();if(c.mousecaptureposition.left>b.pageX){if(G>=j&&j>=F){y=D,z=!0;break}}else if(G>=r&&r>=F){y=D,z=!0;break}}}z||(c.mousecaptureposition.left>b.pageX?a.each(this.columns.records,function(a,b){return!!(c.groupable&&c.groups.length>0&&a<c.groups.length)||(this.pinned||this.hidden?void 0:(y=a,!1))}):(!c.groupable||c.groupable&&!c.groups.length>0)&&(y=v.cells.length-1));var I=x;x=Math.min(x,y),y=Math.max(I,y),o+=5,o+=f;for(var K=(c.table[0].rows.indexOf(c.mousecaptureposition.clickedrow),0),L=-1,M=-1,N=0,D=0;D<c.table[0].rows.length;D++){var O=a(c.table[0].rows[D]);0==D&&(N=O.coord().top);var P=O.height(),Q=N-h.top;if(-1==L&&Q+P>=o){for(var R=!1,S=0;S<c.groups.length;S++){var T=O[0].cells[S].className;if(-1!=T.indexOf("tis-grid-group-collapse")||-1!=T.indexOf("tis-grid-group-expand")){R=!0;break}}if(R)continue;L=D}if(N+=P,c.groupable&&c.groups.length>0){for(var R=!1,S=0;S<c.groups.length;S++){var T=O[0].cells[S].className;if(-1!=T.indexOf("tis-grid-group-collapse")||-1!=T.indexOf("tis-grid-group-expand")){R=!0;break}}if(R)continue;for(var w=0,U=c.groups.length;U<O[0].cells.length;U++){var V=O[0].cells[U];""==a(V).html()&&w++}if(w==O[0].cells.length-c.groups.length)continue}if(-1!=L&&(K+=P),Q+P>o+q){M=D;break}}if(-1!=L){o=a(c.table[0].rows[L]).coord().top-h.top-f-2;var W=0;this.filterable&&this.showfilterrow&&(W=this.filterrowheight),parseFloat(c.table[0].style.top)<0&&o<this.rowsheight+W&&(o-=parseFloat(c.table[0].style.top),K+=parseFloat(c.table[0].style.top)),q=K;var X=a(this.columnsrow[0].cells[x]),Y=a(this.columnsrow[0].cells[y]);if(n=parseFloat(X.css("left")),p=parseFloat(Y.css("left"))-parseFloat(n)+Y.width()-2,n-=u,C&&(n+=u),c.editcell&&c.editable&&c.endcelledit&&(x!=y||L!=M)){if(0==c.editcell.validated)return;c.endcelledit(c.editcell.row,c.editcell.column,!0,!0)}}}this.selectionarea.width(p),this.selectionarea.height(q),this.selectionarea.css("left",n),this.selectionarea.css("top",o)}}},_handlemouseupselection:function(b,c){if(this.selectionarea){if("visible"!=this.selectionarea[0].style.visibility)return c.mousecaptured=!1,!0;if(c.mousecaptured&&("multiplerowsextended"==c.selectionmode||"multiplerowsadvanced"==c.selectionmode||"multiplecellsextended"==c.selectionmode||"multiplecellsadvanced"==c.selectionmode)&&(c.mousecaptured=!1,"visible"==this.selectionarea.css("visibility"))){this.selectionarea.css("visibility","hidden");var d=this.showheader?this.columnsheader.height()+2:0,e=this._groupsheader()?this.groupsheader.height():0;"0px"===this.host.css("border-top-width")&&(e-=2);e+=this.showtoolbar?this.toolbar.height():0;var g=this.selectionarea.coord(),h=this.host.coord();this.hasTransform&&(h=a.tis.utilities.getOffset(this.host),g=a.tis.utilities.getOffset(this.selectionarea)),"0px"===this.host.css("border-top-width")&&(e-=2);var i=g.left-h.left,j=g.top-d-h.top-e,k=j,l=i+this.selectionarea.width(),m=i,n=new Array,o=new Array;if("multiplerowsextended"==c.selectionmode){for(;j<k+this.selectionarea.height();){var p=this._hittestrow(i,j),q=p.row,r=p.index;-1!=r&&(o[r]||(o[r]=!0,n[n.length]=p)),j+=20}var k=0;a.each(n,function(){var d=this.row;"none"!=c.selectionmode&&c._selectrowwithmouse&&(b.ctrlKey||b.metaKey?c._applyrowselection(c.getboundindex(d),!0,!1,!1):0==k?c._applyrowselection(c.getboundindex(d),!0,!1,!0):c._applyrowselection(c.getboundindex(d),!0,!1,!1),k++)})}else{"multiplecellsadvanced"==c.selectionmode&&(j+=2);var s=c.hScrollInstance,t=s.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(t=s.max-s.value),"hidden"!=this.vScrollBar[0].style.visibility&&(t-=this.scrollbarsize+4));var u=c.table[0].rows[0],v=c.selectionarea.height();!b.ctrlKey&&!b.metaKey&&v>0&&(c.selectedcells=new Array);for(var w=v;j<k+w;){var p=c._hittestrow(i,j);if(p){var q=p.row,r=p.index;if(-1!=r&&!o[r]){o[r]=!0;for(var x=0;x<u.cells.length;x++){var y=parseFloat(a(c.columnsrow[0].cells[x]).css("left"))-t,z=y+a(c.columnsrow[0].cells[x]).width();(m>=y&&m<=z||l>=y&&l<=z||y>=m&&y<=l)&&c._applycellselection(c.getboundindex(q),c._getcolumnat(x).datafield,!0,!1)}}j+=5}else j+=5}}c.autosavestate&&c.savestate&&c.savestate(),c._renderrows(c.virtualsizeinfo)}}},selectprevcell:function(a,b){var c=this._getcolumnindex(b),e=(this.columns.records.length,this._getprevvisiblecolumn(c));null!=e&&(this.clearselection(),this.selectcell(a,e.datafield))},selectnextcell:function(a,b){var c=this._getcolumnindex(b),e=(this.columns.records.length,this._getnextvisiblecolumn(c));null!=e&&(this.clearselection(),this.selectcell(a,e.datafield))},_getfirstvisiblecolumn:function(){for(var b=this.columns.records.length,c=0;c<b;c++){var d=this.columns.records[c];if(!d.hidden&&null!=d.datafield)return d}return null},_getlastvisiblecolumn:function(){for(var b=this.columns.records.length,c=b-1;c>=0;c--){var d=this.columns.records[c];if(!d.hidden&&null!=d.datafield)return d}return null},_handlekeydown:function(b,c){if(c.groupable&&c.groups.length,c.disabled)return!1;var d=b.charCode?b.charCode:b.keyCode?b.keyCode:0;if(c.editcell&&"multiplecellsadvanced"!=c.selectionmode)return!0;if(c.editcell&&"multiplecellsadvanced"==c.selectionmode){if(!(d>=33&&d<=40))return!0;if(b.altKey)return c._cancelkeydown=!1,!0;if(void 0!=c._cancelkeydown&&0!=c._cancelkeydown)return c._cancelkeydown=!1,!0;if("selectedrow"===c.editmode)return!0;if(c.endcelledit(c.editcell.row,c.editcell.column,!1,!0),c._cancelkeydown=!1,c.editcell&&!c.editcell.validated)return c._rendervisualrows(),c.endcelledit(c.editcell.row,c.editcell.column,!1,!0),!1}if("none"==c.selectionmode)return!0;if(c.showfilterrow&&c.filterable&&this.filterrow&&a(b.target).ischildof(c.filterrow))return!0;if(c.showeverpresentrow){if(c.addnewrowtop&&a(b.target).ischildof(c.addnewrowtop))return!0;if(c.addnewrowbottom&&a(b.target).ischildof(c.addnewrowbottom))return!0}if(b.target.className&&b.target.className.indexOf("tis-grid-widget")>=0)return!0;if(c.pageable&&a(b.target).ischildof(this.pager))return!0;if(this.showtoolbar&&a(b.target).ischildof(this.toolbar))return!0;if(this.showstatusbar&&a(b.target).ischildof(this.statusbar))return!0;var e=!1;if(b.altKey)return!0;if((b.ctrlKey||b.metaKey)&&this.clipboard){var f=String.fromCharCode(d).toLowerCase();if(this.clipboardbegin){var g=null;if("c"==f?g=this.clipboardbegin("copy",this.copyselection()):"x"==f?g=this.clipboardbegin("cut",this.copyselection()):"v"==f&&(g=this.clipboardbegin("paste")),!1===g)return!1}if("c"==f||"x"==f){var h=this.copyselection();if("c"==f&&this.clipboardend&&this.clipboardend("copy"),"x"==f&&this.clipboardend&&this.clipboardend("cut"),window.clipboardData)window.clipboardData.setData("Text",h);else{var i=a('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');i.val(h),a("body").append(i),i.select(),setTimeout(function(){document.designMode="off",i.select(),i.remove(),c.focus()},100)}if("c"==f&&a.tis.browser.msie)return!1;if("c"==f)return!0}else if("v"==f){var j=a('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');a("body").append(j),j.select();var k=this;return setTimeout(function(){k._clipboardselection=new Array;var a=j.val();if(0==a.length&&window.clipboardData){j.val(window.clipboardData.getData("Text"));var a=j.val()}for(var b=a.split("\n"),c=0;c<b.length;c++)if(b[c].split("\t").length>0){var d=b[c].split("\t");if(1==d.length&&c==b.length-1&&""==d[0])continue;d.length>0&&k._clipboardselection.push(d)}k.pasteselection(),j.remove(),k.focus()},100),!0}if("x"==f)return this.deleteselection(),this.host.focus(),!1}var l=Math.round(c._gettableheight()),m=Math.round(l/c.rowsheight),n=c.getdatainformation();switch(c.selectionmode){case"singlecell":case"multiplecells":case"multiplecellsextended":case"multiplecellsadvanced":var o=c.getselectedcell();if(null!=o){var p=this.getrowvisibleindex(o.rowindex),q=p,r=o.datafield,s=c._getcolumnindex(r),u=(c.columns.records.length,function(a,d,f,g){var h=function(a,b){var d=c.dataview.loadedrecords[a];if(c.groupable&&c.groups.length>0){var h=a;"up"==g&&h++,"down"==g&&h--;for(var d=c.getdisplayrows()[h],i=function(a){return!!a.group&&(c.expandedgroups[a.uniqueid]?c.expandedgroups[a.uniqueid].expanded:void 0)},j=1,k=!0;k&&j<300&&(k=!1,"down"==g?d=c.getdisplayrows()[h+j]:"up"==g&&(d=c.getdisplayrows()[h-j]),d);){d&&d.group&&(k=!0);for(var l=d.parentItem;l;)l&&!i(l)&&(k=!0),l=l.parentItem;if(!k)break;j++}if(300==j&&(d=null),c.pageable){var m=!1;if(d){for(var n=0;n<c.dataview.rows.length;n++)c.dataview.rows[n].boundindex==d.boundindex&&(m=!0);m||(d=null)}}}if(void 0!=d&&null!=b){(f||void 0==f)&&c.clearselection();var o=c.getboundindex(d);return c.selectcell(o,b),c._oldselectedcell=c.selectedcell,e=!0,c.ensurecellvisible(a,b),!0}return!1};if(h(a,d)||(c.ensurecellvisible(a,d),h(a,d),c.virtualmode&&c.host.focus()),!(c.groupable&&c.groups.length>0))if(b.shiftKey&&9!=b.keyCode){if(("multiplecellsextended"==c.selectionmode||"multiplecellsadvanced"==c.selectionmode)&&c._lastClickedCell){c._selectpath(a,d);var j=c.dataview.loadedrecords[a],k=c.getboundindex(j);return void(c.selectedcell={rowindex:k,datafield:d})}}else b.shiftKey||(c._lastClickedCell={row:a,column:d})}),v=b.shiftKey&&"singlecell"!=c.selectionmode&&"multiplecells"!=c.selectionmode,w=function(){u(0,r,!v)},x=function(){var a=n.rowscount-1;u(a,r,!v)},y=9==d&&!b.shiftKey,z=9==d&&b.shiftKey;if(c.rtl){var A=y;y=z,z=A}if((y||z)&&(v=!1),(y||z)&&document.activeElement&&document.activeElement.className&&document.activeElement.className.indexOf("tis-grid-cell-add-new-row")>=0)return!0;var B=b.ctrlKey||b.metaKey;if(B&&37==d){var C=c._getfirstvisiblecolumn(s);null!=C&&u(q,C.datafield)}else if(B&&39==d){var D=c._getlastvisiblecolumn(s);null!=D&&u(q,D.datafield)}else if(39==d||y){var E=c._getnextvisiblecolumn(s);if(null!=E)u(q,E.datafield,!v);else if(y){var F=c._getfirstvisiblecolumn();d=40,r=F.displayfield}else e=!0}else if(37==d||z){var C=c._getprevvisiblecolumn(s);if(null!=C)u(q,C.datafield,!v);else if(z){var G=c._getlastvisiblecolumn();d=38,r=G.displayfield}else e=!0}else if(36==d)w();else if(35==d)x();else if(33==d)if(q-m>=0){var H=q-m;u(H,r,!v)}else w();else if(34==d)if(n.rowscount>q+m){var H=q+m;u(H,r,!v)}else x();38==d&&(B?w():q>0?u(q-1,r,!v,"up"):e=!0),40==d&&(B?x():n.rowscount>q+1||c.groupable&&c.groups.length>0?u(q+1,r,!v,"down"):e=!0)}break;case"singlerow":case"multiplerows":case"multiplerowsextended":case"multiplerowsadvanced":var q=c.getselectedrowindex();if(null==q||-1==q)return!0;q=this.getrowvisibleindex(q);var I=function(a,f,g){var h=function(a){var b=c.dataview.loadedrecords[a];if(c.groupable&&c.groups.length>0){"up"==g&&a++,"down"==g&&a--;for(var b=c.getdisplayrows()[a],d=function(a){return!!a.group&&(c.expandedgroups[a.uniqueid]?c.expandedgroups[a.uniqueid].expanded:void 0)},h=1,i=!0;i&&h<300&&(i=!1,"down"==g?b=c.getdisplayrows()[a+h]:"up"==g&&(b=c.getdisplayrows()[a-h]),b);){b&&b.group&&(i=!0);for(var j=b.parentItem;j;)j&&!d(j)&&(i=!0),j=j.parentItem;if(!i)break;h++}if(300==h&&(b=null),c.pageable){var k=!1;if(b){for(var l=0;l<c.dataview.rows.length;l++)c.dataview.rows[l].boundindex==b.boundindex&&(k=!0);k||(b=null)}}}if(void 0!=b){var m=c.getboundindex(b),n=c.selectedrowindex;(f||void 0==f)&&c.clearselection(),c.selectedrowindex=n,c.selectrow(m,!1);return(!c.ensurerowvisible(a)||c.autoheight||c.groupable)&&c._rendervisualrows(),e=!0,!0}return!1};if(h(a)||(c.ensurerowvisible(a),h(a,f),c.virtualmode&&setTimeout(function(){h(a,f)},25),c.virtualmode&&c.host.focus()),!(c.groupable&&c.groups.length>0))if(b.shiftKey&&9!=d){if("multiplerowsextended"==c.selectionmode&&c._lastClickedCell)return c._selectrowpath(a),void(c.selectedrowindex=c.getrowboundindex(a))}else b.shiftKey||(c._lastClickedCell={row:a},c.selectedrowindex=c.getrowboundindex(a))},v=b.shiftKey&&"singlerow"!=c.selectionmode&&"multiplerows"!=c.selectionmode,w=function(){I(0,!v)},x=function(){var a=n.rowscount-1;I(a,!v)},B=b.ctrlKey||b.metaKey;if(36==d||B&&38==d)w();else if(35==d||B&&40==d)x();else if(33==d)if(q-m>=0){var H=q-m;I(H,!v)}else w();else if(34==d)if(n.rowscount>q+m){var H=q+m;I(H,!v)}else x();else 38==d?q>0?I(q-1,!v,"up"):e=!0:40==d&&(n.rowscount>q+1||c.groupable&&c.groups.length>0?I(q+1,!v,"down"):e=!0)}return!e||(c.autosavestate&&c.savestate&&c.savestate(),!1)},_handlemousemove:function(b,c){if(!c.vScrollInstance.isScrolling()&&!c.hScrollInstance.isScrolling()){var d,e,f,g,h;if(c.enablehover||"multiplerows"==c.selectionmode){d=this.showheader?this.columnsheader.height()+2:0,e=this._groupsheader()?this.groupsheader.height():0;if(e+=this.showtoolbar?this.toolbarheight:0,f=this.host.coord(),this.hasTransform){f=a.tis.utilities.getOffset(this.host);var j=this._getBodyOffset();f.left-=j.left,f.top-=j.top}g=b.pageX-f.left,h=b.pageY-d-f.top-e}if("multiplerowsextended"!=c.selectionmode&&"multiplecellsextended"!=c.selectionmode&&"multiplecellsadvanced"!=c.selectionmode||1!=c.mousecaptured){if(!c.enablehover)return!0;if(!c.disabled&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var k=this._hittestrow(g,h);if(k){var l=k.row,m=k.index;if((-1==this.hoveredrow||-1==m||this.hoveredrow!=m||-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode)&&(this._clearhoverstyle(),-1!=m&&void 0!=l)){var n=this.hittestinfo[m].visualrow;if(null!=n&&!(this.hittestinfo[m].details||b.clientX>a(n).width()+a(n).coord().left)){var o=0,p=n.cells.length;if(c.rowdetails&&c.showrowdetailscolumn?this.rtl?(p-=1,p-=this.groups.length):o=1+this.groups.length:this.groupable&&(this.rtl?p-=this.groups.length:o=this.groups.length),0!=n.cells.length){var q=n.cells[o].className;if(!(l.group||this.selectionmode.indexOf("row")>=0&&-1!=q.indexOf("tis-grid-cell-selected")))if(this.hoveredrow=m,-1==this.selectionmode.indexOf("cell")&&"checkbox"!=this.selectionmode)for(var u=o;u<p;u++){var x=n.cells[u];a(x).addClass(this.toTP("tis-grid-cell-hover")),a(x).addClass(this.toTP("tis-fill-state-hover")),this.cellhover&&this.cellhover(x,b.pageX,b.pageY)}else{var r=-1,s=this.hScrollInstance,t=s.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(t=s.max-s.value);for(var u=o;u<p;u++){var v=parseInt(a(this.columnsrow[0].cells[u]).css("left"))-t;this.columns.records[u].pinned&&!this.rtl&&(v=parseInt(a(this.columnsrow[0].cells[u]).css("left")));var w=v+a(this.columnsrow[0].cells[u]).width();if(w>=g&&g>=v){r=u;break}}if(-1!=r){var x=n.cells[r];if(this.cellhover&&this.cellhover(x,b.pageX,b.pageY),-1==x.className.indexOf("tis-grid-cell-selected")){if(this.editcell){var y=this._getcolumnat(r);if(y&&this.editcell.row==m&&this.editcell.column==y.datafield)return}a(x).addClass(this.toTP("tis-grid-cell-hover")),a(x).addClass(this.toTP("tis-fill-state-hover"))}}}}}}}}}}}})}(tisBaseFramework);